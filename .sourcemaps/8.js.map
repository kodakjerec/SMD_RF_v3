{"version":3,"sources":["../../src/pages/_13_WAS/4_Receive/Receive.module.ts","../../src/pages/_13_WAS/4_Receive/Receive.ts"],"names":[],"mappings":"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","file":"8.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\nimport { _134_WAS_Receive } from './Receive';\r\n\r\n@NgModule({\r\n    imports: [\r\n        CommonModule,\r\n        IonicPageModule.forChild(_134_WAS_Receive)\r\n    ],\r\n    declarations: [_134_WAS_Receive],\r\n    entryComponents: [_134_WAS_Receive]\r\n})\r\nexport class AppModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/_13_WAS/4_Receive/Receive.module.ts","import { Component, ViewChild } from '@angular/core';\r\nimport { NavController, Platform, NavParams, ToastController, IonicPage } from 'ionic-angular';\r\n\r\n//Cordova\r\nimport { Keyboard } from '@ionic-native/keyboard';\r\nimport { Vibration } from '@ionic-native/vibration';\r\n\r\n//My Pages\r\nimport * as myGlobals from '../../../app/Settings';\r\nimport { http_services } from '../../_ZZ_CommonLib/http_services';\r\n\r\n@IonicPage({\r\n    name: '_134_WAS_Receive',\r\n    segment: '_134_WAS_Receive'\r\n})\r\n@Component({\r\n    templateUrl: 'Receive.html'\r\n})\r\nexport class _134_WAS_Receive {\r\n    constructor(public navCtrl: NavController\r\n        , public platform: Platform\r\n        , public navParams: NavParams\r\n        , public _http_services: http_services\r\n        , private toastCtrl: ToastController\r\n        , private keyboard: Keyboard\r\n        , private vibration: Vibration) {\r\n\r\n        this.data.RefValue = localStorage.getItem('WAS_OrderNo') + ',' + localStorage.getItem('WAS_Item') + ',' + localStorage.getItem('WAS_Store');\r\n        this.data.BLOCK_NAME = myGlobals.ProgParameters.get('BLOCK_NAME');\r\n\r\n        this.initializeApp();\r\n    }\r\n    @ViewChild('scan_Entry') scan_Entry;\r\n\r\n    ionViewWillEnter() {\r\n        this.BringDisplayList();\r\n    }\r\n\r\n    data = {\r\n        RefValue: ''\r\n        , BLOCK_NAME: ''\r\n        , WAS_Barcode: ''\r\n        , IsHideWhenKeyboardOpen: false\r\n    };  // IsDisabled控制\"btn報到\"是否顯示，預設不顯示：IsDisabled = true\r\n\r\n    Receive = {\r\n        ORDER_NO: ''\r\n        , ITEM_NO: ''\r\n        , SITE_ID: ''\r\n        , AMOUNT: 0\r\n        , TQty: 0\r\n        , TWeight: 0.00\r\n        , LeftQty: 0\r\n        , PRICE: 0\r\n        , PRICE_TYPE: '0'\r\n        , SID: 0\r\n        , SEQ: 0\r\n        , ITEM_NAME: ''\r\n        , SITE_NAME: ''\r\n        , PRICE_TYPE_NAME: ''\r\n    };\r\n    DefaultTestServer = '172_31_31_250';\r\n\r\n    initializeApp() {\r\n        if (this.platform.is('core')) {\r\n            console.log(\"You're develop in the browser\");\r\n            return;\r\n        }\r\n        this.platform.ready()\r\n            .then(() => {\r\n                this.keyboard.onKeyboardShow().subscribe(() => { this.data.IsHideWhenKeyboardOpen = true });\r\n                this.keyboard.onKeyboardHide().subscribe(() => { this.data.IsHideWhenKeyboardOpen = false });\r\n            })\r\n            ;\r\n    }\r\n\r\n    BringDisplayList() {\r\n        let sql_parameter = this.data.RefValue + ','\r\n\r\n        this._http_services.POST(this.DefaultTestServer, 'sp'\r\n            , '[WAS].dbo.spactWAS_Line_v2'\r\n            , [{ Name: '@Step', Value: '21' }\r\n                , { Name: '@Parameters', Value: sql_parameter }])\r\n            .subscribe((response) => {\r\n                if (response != undefined) {\r\n                    this.Receive = response[0];\r\n\r\n                    let PRICE_TYPE_NAME = '';\r\n                    switch (this.Receive.PRICE_TYPE) {\r\n                        case '0':\r\n                            PRICE_TYPE_NAME = '秤重';\r\n                            break;\r\n                        case '1':\r\n                            PRICE_TYPE_NAME = '定額';\r\n                            break;\r\n                    }\r\n                    this.Receive.PRICE_TYPE_NAME = PRICE_TYPE_NAME;\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    this.scan_Entry.setFocus();\r\n                }, 500);\r\n            });\r\n    }\r\n\r\n    //重置btn\r\n    reset() {\r\n        this.data.WAS_Barcode = '';\r\n\r\n        this.scan_Entry.setFocus();\r\n    };\r\n\r\n    //查詢\r\n    search() {\r\n        this.vibration.vibrate(100);\r\n\r\n        //test\r\n        this.data.WAS_Barcode =\r\n            '20'\r\n            + this.Receive.ITEM_NO;\r\n        for (let i = 0; i < (4 - this.Receive.PRICE.toString().length); i++) {\r\n            this.data.WAS_Barcode += '0';\r\n        }\r\n        this.data.WAS_Barcode += this.Receive.PRICE + '1';\r\n\r\n        let ITEM_NO = this.data.WAS_Barcode.substr(2, 6);\r\n        let Price = this.data.WAS_Barcode.substr(8, 4);\r\n        let AssignQty = 0;\r\n        let AssignWeight = 0.00;\r\n\r\n        //#region Error-Check\r\n        let ErrMsg = '';\r\n        if (ITEM_NO != this.Receive.ITEM_NO) {\r\n            ErrMsg = '條碼 與 呼出碼 不吻合';\r\n        }\r\n\r\n        try {\r\n            switch (this.Receive.PRICE_TYPE) {\r\n                case '0':\r\n                    AssignQty += 1;\r\n                    AssignWeight += parseFloat((parseInt(Price) / this.Receive.PRICE * 1.1).toFixed(2));\r\n                    break;\r\n                case '1':\r\n                    AssignQty += 1;\r\n                    break;\r\n            }\r\n        } catch (err) {\r\n            ErrMsg = err;\r\n        }\r\n\r\n        if (ErrMsg.length > 0) {\r\n            this.toastCtrl.create({\r\n                message: ErrMsg,\r\n                duration: myGlobals.Set_timeout,\r\n                position: 'bottom'\r\n            }).present()\r\n                .then(response => {\r\n                    setTimeout(() => {\r\n                        this.scan_Entry.setFocus();\r\n                    }, 150);\r\n                });\r\n            return;\r\n        }\r\n        //#endregion Error-Check\r\n\r\n        //#region 驗收\r\n        let sql_parameter = this.data.RefValue\r\n            + ',' + AssignQty.toString()\r\n            + ',' + AssignWeight.toString();\r\n        this._http_services.POST(this.DefaultTestServer, 'sp'\r\n            , '[WAS].dbo.spactWAS_Line_v2'\r\n            , [{ Name: '@Step', Value: '3' }\r\n                , { Name: '@Parameters', Value: sql_parameter }])\r\n            .subscribe((response) => {\r\n                if (response != undefined) {\r\n                    console.log(response);\r\n                    this.Receive.TQty += AssignQty;\r\n                    this.Receive.LeftQty -= AssignQty;\r\n\r\n                    this.Receive.TWeight = parseFloat((this.Receive.TWeight + AssignWeight).toFixed(2));\r\n\r\n                    if (this.Receive.LeftQty <= 0) {\r\n                        //驗收完畢\r\n                        this.reset();\r\n                        this.navCtrl.pop();\r\n                    }\r\n                    else {\r\n                        //繼續驗收\r\n                        this.data.WAS_Barcode = '';\r\n                        this.scan_Entry.setFocus();\r\n                    }\r\n                }\r\n            });\r\n        //#endregion 驗收\r\n    }\r\n\r\n    //全選\r\n    selectAll($event) {\r\n        $event._native.nativeElement.select();\r\n    }\r\n    //Focus\r\n    myFocus() {\r\n        this.scan_Entry.setFocus();\r\n    }\r\n\r\n    //手勢\r\n    swipeEvent(event) {\r\n        switch (event.direction) {\r\n            case 1: //NONE\r\n                break;\r\n            case 2: //LEFT\r\n\r\n                break;\r\n            case 4: //RIGHT\r\n                this.reset();\r\n                this.navCtrl.pop();\r\n                break;\r\n            case 8: //UP\r\n                break;\r\n            case 16://DOWN\r\n                break;\r\n        };\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/_13_WAS/4_Receive/Receive.ts"],"sourceRoot":""}